# SACToR å®‰å…¨éªŒè¯æœºåˆ¶è¯¦è§£

## ğŸ” **SACToR çš„å¤šå±‚å®‰å…¨éªŒè¯ä½“ç³»**

SACToR ä½¿ç”¨äº†ä¸€ä¸ªå®Œæ•´çš„å¤šå±‚å®‰å…¨éªŒè¯ä½“ç³»æ¥ç¡®ä¿ç”Ÿæˆçš„ Rust ä»£ç æ˜¯å®‰å…¨çš„ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„éªŒè¯æœºåˆ¶ï¼š

## 1. **ç¼–è¯‘æ—¶å®‰å…¨éªŒè¯**

### 1.1 Rust ç¼–è¯‘å™¨æ£€æŸ¥
```python
# ä½ç½®: sactor/verifier/verifier.py:119-131
cmd = ["cargo", "build", "--manifest-path", f"{self.build_attempt_path}/Cargo.toml"]
result = subprocess.run(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
if result.returncode != 0:
    return (VerifyResult.COMPILE_ERROR, result.stderr.decode())
```

**éªŒè¯å†…å®¹**ï¼š
- âœ… **å†…å­˜å®‰å…¨**ï¼šRust ç¼–è¯‘å™¨è‡ªåŠ¨æ£€æŸ¥å†…å­˜å®‰å…¨
- âœ… **æ‰€æœ‰æƒè§„åˆ™**ï¼šé˜²æ­¢ use-after-free å’ŒåŒé‡é‡Šæ”¾
- âœ… **å€Ÿç”¨æ£€æŸ¥**ï¼šé˜²æ­¢æ•°æ®ç«äº‰å’Œæ‚¬ç©ºå¼•ç”¨
- âœ… **ç±»å‹å®‰å…¨**ï¼šå¼ºç±»å‹ç³»ç»Ÿé˜²æ­¢ç±»å‹é”™è¯¯

### 1.2 ä»£ç æ ¼å¼åŒ–æ£€æŸ¥
```python
# ä½ç½®: sactor/verifier/verifier.py:109-116
cmd = ["cargo", "fmt", "--manifest-path", f"{self.build_attempt_path}/Cargo.toml"]
result = subprocess.run(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
if result.returncode != 0:
    return (VerifyResult.COMPILE_ERROR, result.stderr.decode())
```

## 2. **é™æ€åˆ†æéªŒè¯**

### 2.1 Clippy é™æ€åˆ†æ
```python
# ä½ç½®: sactor/combiner/program_combiner.py:189-214
cmd = ["cargo", "clippy", "--fix", "--allow-no-vcs", "--manifest-path", 
       os.path.join(build_dir, "Cargo.toml")]

cmd = ["cargo", "clippy", "--manifest-path", os.path.join(build_dir, "Cargo.toml")]
result = subprocess.run(cmd, capture_output=True)
```

**éªŒè¯å†…å®¹**ï¼š
- âœ… **ä»£ç é£æ ¼**ï¼šç¬¦åˆ Rust æœ€ä½³å®è·µ
- âœ… **æ€§èƒ½é—®é¢˜**ï¼šæ£€æµ‹æ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆ
- âœ… **é€»è¾‘é”™è¯¯**ï¼šæ£€æµ‹å¯èƒ½çš„é€»è¾‘é—®é¢˜
- âœ… **æœªä½¿ç”¨ä»£ç **ï¼šæ¸…ç†æœªä½¿ç”¨çš„å˜é‡å’Œå‡½æ•°
- âœ… **è‡ªåŠ¨ä¿®å¤**ï¼šä½¿ç”¨ `--fix` è‡ªåŠ¨ä¿®å¤é—®é¢˜

### 2.2 ç»Ÿè®¡è­¦å‘Šå’Œé”™è¯¯
```python
total_warnings, total_errors = self._get_warning_error_count(compiler_output_lines)
```

## 3. **è¿è¡Œæ—¶å®‰å…¨éªŒè¯**

### 3.1 å†…å­˜å®‰å…¨æ£€æŸ¥ (Valgrind)
```python
# ä½ç½®: sactor/verifier/verifier.py:169-184
valgrind_cmd = [
    'valgrind',
    '--error-exitcode=1',
    '--leak-check=no',
    '--trace-children=yes',
    '--',
]

if valgrind:
    cmd = valgrind_cmd + cmd
```

**éªŒè¯å†…å®¹**ï¼š
- âœ… **å†…å­˜æ³„æ¼æ£€æµ‹**ï¼šæ£€æµ‹æœªé‡Šæ”¾çš„å†…å­˜
- âœ… **ç¼“å†²åŒºæº¢å‡º**ï¼šæ£€æµ‹æ•°ç»„è¶Šç•Œè®¿é—®
- âœ… **æœªåˆå§‹åŒ–å†…å­˜**ï¼šæ£€æµ‹ä½¿ç”¨æœªåˆå§‹åŒ–çš„å˜é‡
- âœ… **æ‚¬ç©ºæŒ‡é’ˆ**ï¼šæ£€æµ‹è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜

### 3.2 æµ‹è¯•ç”¨ä¾‹éªŒè¯
```python
# ä½ç½®: sactor/verifier/verifier.py:179-211
for i, cmd in enumerate(test_cmds):
    res = subprocess.run(cmd, env=env, stdout=subprocess.PIPE, 
                        stderr=subprocess.PIPE, timeout=timeout)
    if res.returncode != 0:
        return (VerifyResult.TEST_ERROR, stderr, i)
```

**éªŒè¯å†…å®¹**ï¼š
- âœ… **åŠŸèƒ½æ­£ç¡®æ€§**ï¼šç¡®ä¿ç¿»è¯‘åçš„ä»£ç åŠŸèƒ½ä¸åŸä»£ç ä¸€è‡´
- âœ… **è¾¹ç•Œæ¡ä»¶**ï¼šæµ‹è¯•å„ç§è¾“å…¥æƒ…å†µ
- âœ… **é”™è¯¯å¤„ç†**ï¼šéªŒè¯é”™è¯¯æƒ…å†µçš„å¤„ç†
- âœ… **è¶…æ—¶æ£€æµ‹**ï¼šé˜²æ­¢æ— é™å¾ªç¯

## 4. **ä»£ç è´¨é‡éªŒè¯**

### 4.1 AST åˆ†æ
```python
# ä½ç½®: sactor/verifier/idiomatic_verifier.py
from sactor import rust_ast_parser
```

**éªŒè¯å†…å®¹**ï¼š
- âœ… **è¯­æ³•æ­£ç¡®æ€§**ï¼šç¡®ä¿ç”Ÿæˆçš„ä»£ç è¯­æ³•æ­£ç¡®
- âœ… **ç»“æ„å®Œæ•´æ€§**ï¼šéªŒè¯ä»£ç ç»“æ„çš„å®Œæ•´æ€§

### 4.2 æŒ‡é’ˆåˆ†æ (Crown)
```python
# ä»è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ° Crown çš„ä½¿ç”¨
rustup run nightly-2023-01-26-x86_64-unknown-linux-gnu crown 
    /tmp/sactor/tmpclaoj59m/build/crown_analysis/src/lib.rs preprocess in-place
```

**éªŒè¯å†…å®¹**ï¼š
- âœ… **æŒ‡é’ˆæ‰€æœ‰æƒ**ï¼šåˆ†ææŒ‡é’ˆçš„æ‰€æœ‰æƒå…³ç³»
- âœ… **æŒ‡é’ˆå¯å˜æ€§**ï¼šç¡®å®šæŒ‡é’ˆçš„å¯å˜æ€§
- âœ… **æŒ‡é’ˆç±»å‹**ï¼šåˆ†ææŒ‡é’ˆæŒ‡å‘çš„æ•°æ®ç±»å‹

## 5. **ç¿»è¯‘æµç¨‹ä¸­çš„éªŒè¯**

### 5.1 ä¸¤é˜¶æ®µç¿»è¯‘éªŒè¯
1. **éæƒ¯ç”¨ç¿»è¯‘** (`_run_unidomatic_translation`)
   - ç”Ÿæˆæ¥è¿‘ C é£æ ¼çš„ Rust ä»£ç 
   - ä½¿ç”¨ `unsafe` å—å’ŒåŸå§‹æŒ‡é’ˆ
   - é€šè¿‡ç¼–è¯‘å’Œæµ‹è¯•éªŒè¯

2. **æƒ¯ç”¨ç¿»è¯‘** (`_run_idiomatic_translation`)
   - å°†éæƒ¯ç”¨ä»£ç è½¬æ¢ä¸ºæƒ¯ç”¨çš„ Rust ä»£ç 
   - ç§»é™¤ `unsafe` å—
   - ä½¿ç”¨å®‰å…¨çš„ Rust æ„é€ 

### 5.2 éªŒè¯ç»“æœç±»å‹
```python
# ä½ç½®: sactor/verifier/verifier_types.py
class VerifyResult(Enum):
    SUCCESS = auto()                    # éªŒè¯æˆåŠŸ
    COMPILE_ERROR = auto()              # ç¼–è¯‘é”™è¯¯
    TEST_ERROR = auto()                 # æµ‹è¯•é”™è¯¯
    TEST_TIMEOUT = auto()               # æµ‹è¯•è¶…æ—¶
    TEST_HARNESS_MAX_ATTEMPTS_EXCEEDED = auto()  # æµ‹è¯•å°è¯•æ¬¡æ•°è¶…é™
    FEEDBACK = auto()                   # éœ€è¦åé¦ˆé‡è¯•
```

## 6. **å®‰å…¨éªŒè¯çš„å±‚æ¬¡ç»“æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            SACToR å®‰å…¨éªŒè¯ä½“ç³»            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ç¼–è¯‘æ—¶å®‰å…¨ (Rust ç¼–è¯‘å™¨)              â”‚
â”‚    â”œâ”€ å†…å­˜å®‰å…¨                          â”‚
â”‚    â”œâ”€ æ‰€æœ‰æƒæ£€æŸ¥                        â”‚
â”‚    â””â”€ å€Ÿç”¨æ£€æŸ¥                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. é™æ€åˆ†æ (Clippy)                    â”‚
â”‚    â”œâ”€ ä»£ç é£æ ¼                          â”‚
â”‚    â”œâ”€ æ€§èƒ½ä¼˜åŒ–                          â”‚
â”‚    â””â”€ æ½œåœ¨é—®é¢˜æ£€æµ‹                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. è¿è¡Œæ—¶éªŒè¯ (Valgrind + æµ‹è¯•)          â”‚
â”‚    â”œâ”€ å†…å­˜æ³„æ¼                          â”‚
â”‚    â”œâ”€ ç¼“å†²åŒºæº¢å‡º                        â”‚
â”‚    â””â”€ åŠŸèƒ½æ­£ç¡®æ€§                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4. ä»£ç è´¨é‡ (AST + Crown)               â”‚
â”‚    â”œâ”€ è¯­æ³•æ­£ç¡®æ€§                        â”‚
â”‚    â”œâ”€ æŒ‡é’ˆåˆ†æ                          â”‚
â”‚    â””â”€ ç»“æ„å®Œæ•´æ€§                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 7. **éªŒè¯å¤±è´¥çš„å¤„ç†æœºåˆ¶**

### 7.1 è‡ªåŠ¨é‡è¯•
- æœ€å¤§å°è¯•æ¬¡æ•°ï¼š`max_translation_attempts = 6`
- æœ€å¤§éªŒè¯å°è¯•æ¬¡æ•°ï¼š`max_verifier_harness_attempts = 6`

### 7.2 åé¦ˆæœºåˆ¶
- æ”¶é›†é”™è¯¯ä¿¡æ¯
- æä¾›ç»™ LLM è¿›è¡Œæ”¹è¿›
- è¿­ä»£ä¼˜åŒ–ç¿»è¯‘ç»“æœ

## 8. **éªŒè¯ç»Ÿè®¡ä¿¡æ¯**

ä»å®é™…è¿è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼š
```json
{
    "total_warnings": 0,
    "total_errors": 0,
    "warnings": {},
    "errors": {}
}
```

## ğŸ¯ **æ€»ç»“**

SACToR çš„å®‰å…¨éªŒè¯æœºåˆ¶æ˜¯ä¸€ä¸ª**å¤šå±‚ã€å…¨æ–¹ä½çš„å®‰å…¨ä¿è¯ä½“ç³»**ï¼š

1. **ç¼–è¯‘å™¨çº§åˆ«**ï¼šRust ç¼–è¯‘å™¨çš„å†…å­˜å®‰å…¨å’Œç±»å‹å®‰å…¨
2. **é™æ€åˆ†æçº§åˆ«**ï¼šClippy çš„ä»£ç è´¨é‡å’Œæœ€ä½³å®è·µæ£€æŸ¥
3. **è¿è¡Œæ—¶çº§åˆ«**ï¼šValgrind çš„å†…å­˜æ£€æŸ¥å’ŒåŠŸèƒ½æµ‹è¯•
4. **ä»£ç åˆ†æçº§åˆ«**ï¼šAST è§£æå’ŒæŒ‡é’ˆåˆ†æ
5. **è¿­ä»£ä¼˜åŒ–çº§åˆ«**ï¼šå¤±è´¥é‡è¯•å’Œåé¦ˆæ”¹è¿›

è¿™ç§å¤šå±‚æ¬¡çš„éªŒè¯ç¡®ä¿äº†ç”Ÿæˆçš„ Rust ä»£ç ä¸ä»…**åŠŸèƒ½æ­£ç¡®**ï¼Œè€Œä¸”**å†…å­˜å®‰å…¨**ã€**ç¬¦åˆ Rust æœ€ä½³å®è·µ**ï¼Œæ˜¯ä¸€ä¸ª**é«˜è´¨é‡çš„ Rust ç¨‹åº**ã€‚
